# Warehouse_Control
ТЗ на проект находится в файле TASK.md

## Warehouse Control - сервис учёта товаров на складе с ролями, авторизацией и историей изменений.
Проект создавался как учебный backend с намеренным использованием антипаттерна — триггеров PostgreSQL для логирования истории.

## Возможности
Работа с транзакциями
 ```
POST /items — создать товар
GET /items — получить список
PUT /items/{id} — обновить
DELETE /items/{id} — удалить
```
История изменений (через триггеры)
Фиксируется:
```
действие: insert, update
старое и новое значение
кто изменил
когда изменил
```
Удаления не логируются, чтобы избежать конфликтов FK и ненужного шума в истории.
История автоматически очищается каскадно при удалении товара.
Роли пользователей
Три роли:
```
admin — полный доступ
manager — просмотр и редактирование
viewer — только просмотр
```
Роль хранится в JWT и проверяется middleware.
Авторизация через JWT
```
POST /auth/register
POST /auth/login
```
После входа пользователь получает токен с user_id и role.

Фильтрация истории
GET /items/{id}/history/filter
Поддерживает фильтры:
```
по пользователю
по типу действия
по диапазону дат
```

## Фронтенд (HTML + JS + Chart.js)
![Скриншот интерфейса](assets/скрин.png)
Позволяет:
авторизоваться (с выбором роли)
смотреть список товаров
редактировать/удалять/добавлять
смотреть историю с фильтрами

## Технологии
Backend:
Go 1.25
Gin
JWT
PоstgreSQL 15
SQLC / sqlx

DB:
таблицы: roles, users, items, item_history
триггеры:
fn_item_before_update — автоинкремент версии
fn_item_audit — логирование insert/update

## Структура проекта
```
cmd/server          — запуск HTTP сервера
internal/
    cfg/            - конфиг
    handlers/       — HTTP слои
    service/        — бизнес-логика
    storage/        — Postgres
    model/          — модели сущностей
    middleware/     — JWT и RBAC
db/
    dumps/     — SQL миграции
web/
    index.html      — простой UI
```

## Запуск
1. Настроить базу
Выполнить миграции из db/dumps
2. Настроить .env
3. Запустить серевер. go run cmd/server/main.go

 по логам убедиться, что сервер запустился на настроенном хосте
 ```
 2025/12/03 16:30:37 [postgres] successfull connect to DB
2025/12/03 16:30:37 [app] Connected to Postgres successfully
2025/12/03 16:30:37 [app]storage initialized successfully
2025/12/03 16:30:37 [app] Service initialized successfully
2025/12/03 16:30:37 [app] starting server on :7777
```
Подготовка базы и кейс тестов API находится в файле TEST_POSTMAN.md

## Warehouse Control — это демонстрация чистой архитектуры на Go:
```
раздельные слои
строгие DTO
SQL-запросы через sqlx
фронтенд без фреймворков
визуализация данных в реальном времени
Приложение подходит как учебный пример и как основа для реального внутреннего финансового инструмента.
```
Автор
```
Разработчик: Vladimirmoscow84
Контакт: ccr1@yandex.ru
GitHub: github.com/Vladimirmoscow84
```